# HomeNetSec

HomeNetSec is a small, dockerized **home network security reporting pipeline** packaged as an OpenClaw *skill source repo*.

It produces a daily report by combining:
- **PCAP-based network telemetry** (offline Zeek analysis)
- **DNS telemetry** (AdGuard Home stats)
- **Behavioral enrichment** (RITA beacon/long-connection analysis)

The repository is intentionally modular so you can swap out **how PCAPs arrive** (OPNsense, tcpdump, SPAN port, etc.) without touching the rest of the pipeline.

## What this does (high level)

1. **PCAP ingest** (your environment provides PCAPs on disk)
2. **Zeek offline parse** (Docker) → Zeek logs per day
3. **Flatten Zeek logs** into a single per-day folder for RITA
4. **RITA analysis** (Docker + MongoDB) on a rolling window
5. **DNS stats** from AdGuard Home API (top clients + blocked domains)
6. **Generate a concise report** (top-N sections)

## Repo / skill layout

- `SKILL.md` — OpenClaw skill metadata + minimal usage notes
- `scripts/run_daily.sh` — main pipeline entrypoint (writes report to disk)
- `scripts/run_and_send_openclaw.sh` — OpenClaw-specific wrapper to send the report (Telegram)
- `assets/docker-compose.yml` — Zeek + RITA + Mongo stack
- `assets/rita-config.yaml.example` — example RITA config
- `references/` — supporting docs

Runtime outputs are not committed (PCAPs/logs/reports/DB).

## How DNS + PCAP are wired (in my setup)

This pipeline assumes two independent inputs:

### PCAP input (network traffic)

In my setup, PCAPs are generated by a firewall/router and periodically pulled onto the machine running HomeNetSec. The pipeline then processes those PCAPs offline.

**Important:** the rest of the pipeline does *not* care *where* PCAPs come from, only that they appear on disk in the expected folder structure.

Expected path:

- `$HOMENETSEC_WORKDIR/pcaps/YYYY-MM-DD/lan-YYYY-MM-DD_*.pcap*`

The default `run_daily.sh` includes a pull step tailored to my environment (SSH copy from a firewall). If you don’t have that, you can:

- disable/replace the pull step, and
- just drop your PCAPs into the folder above.

### DNS input (resolver telemetry)

DNS telemetry is collected from **AdGuard Home** via its HTTP API.

Expected configuration is provided via environment variables (or a sourced env file):
- `ADGUARD_URL`
- `ADGUARD_USER`
- `ADGUARD_PASS`

This is used only for summary stats in the report (e.g., top clients, top blocked domains). It is not required to run PCAP/Zeek/RITA.

## Configuration

### Core environment variables

- `HOMENETSEC_WORKDIR` — where PCAPs/logs/reports live (default: `./output`)
- `RUN_RITA` — set to `0` to skip RITA (default: `1`)

### PCAP ingest (optional, environment-specific)

If you use the built-in pull step:
- `OPNSENSE_HOST`
- `OPNSENSE_USER`
- `OPNSENSE_KEY` (path to SSH private key)
- `OPNSENSE_PCAP_DIR`

If you *don’t* use the pull step, ignore these and just place PCAPs in the workdir.

### AdGuard Home (optional)

- `ADGUARD_ENV` — path to an env file with `ADGUARD_URL/USER/PASS`
  - default: `~/.openclaw/credentials/adguard.env`

## Running

Generate a report for today:

```bash
export HOMENETSEC_WORKDIR="$PWD/output"
./scripts/run_daily.sh
```

Generate a report for a specific day:

```bash
./scripts/run_daily.sh 2026-02-06
```

## Modularity notes (how to adapt this to your network)

The cleanest way to adapt HomeNetSec is to treat it as three layers:

1. **Ingest layer**: get PCAPs into `$HOMENETSEC_WORKDIR/pcaps/YYYY-MM-DD/`
2. **Analysis layer**: Zeek + flatten + RITA (Docker)
3. **Delivery layer**: send report to your preferred destination

If you change your ingest or delivery method, you should not need to change the Zeek/RITA core.

## Security & privacy

- Do **not** commit PCAPs, Zeek logs, reports, or credential files.
- Keep secrets in environment variables or external env files.
- PCAPs may contain sensitive metadata/content; handle and share with care.
